# 発車標っぽいなにか — 使い方

このリポジトリは、簡易的な「発車標風表示」の静的ページです。主に `index.html` と `script.js` で動作します。

**概要**
- 表示: 現在時刻に基づき、時刻表から「直近の発車（最大4件）」を表示します。
- 自動更新: ページを開いている間は 1 分ごとに表示を更新します（`script.js` 内の `setInterval`）。
- データ: デフォルトでは `script.js` 内の配列（ハードコーディング）を使用します。

**ファイル**
- `index.html`: 表示用の HTML。出力領域（時刻、種別、行先、のりば）を含みます。
- `script.js`: 表示ロジック。ハードコードされた時刻表を参照し、次の発車を決めて DOM に反映します。
- `style.css`: 見た目を整えるスタイルシート。
- `data/平日ダイヤ.csv`: （サンプルや外部データを置く場所）CSV を配置できますが、現状は自動的に読み込みません。

**起動方法（ローカルで見る）**
- 単純にブラウザで開く方法:
  - ファイルを直接開く: `index.html` をブラウザでダブルクリックして開きます（ローカルファイルで動作します）。
  - ただし、将来的に `fetch()` で CSV を読み込む実装にするときはローカルファイルでは CORS の制約が出るため、簡易サーバで提供してください。

- 簡易サーバで提供する方法 (推奨、同一マシンで試すとき):

```bash
# カレントをリポジトリのルートにして実行
python3 -m http.server 8000
# その後ブラウザで http://localhost:8000 を開く
```

**現在の使い方（現状の挙動）**
- ページを開くと `script.js` に定義された `timetable` 配列から現在時刻より後の発車を検索し、直近 4 件を画面に表示します。
- 画面上部に「ご案内」テキスト（出発までの余裕度合い）を表示します。
- 種別（例: 普通、快速、特急）に応じて CSS のクラスを切り替えています。

**CSV を使いたい場合（手動で有効化する方法）**
1. `data/平日ダイヤ.csv` に次のような形式で保存します（ヘッダあり）：

```
時刻,種別,行先,のりば
06:33,普通,東京,1
07:15,快速,大阪,2
```

2. `script.js` を編集して CSV を読み込むロジックを追加します。簡単な例（fetch + CSV パース）は以下のようになります：

```javascript
// 例: CSV を取得して timetable 配列を生成する（ページ読み込み時）
async function loadCsvToTimetable(url) {
  const res = await fetch(url);
  const text = await res.text();
  const lines = text.trim().split(/\r?\n/);
  const header = lines.shift().split(',');
  return lines.map(line => {
    const cols = line.split(',');
    return {
      時刻: cols[0].trim(),
      種別: cols[1].trim(),
      行先: cols[2].trim(),
      のりば: cols[3] ? cols[3].trim() : ''
    };
  });
}

// 使い方
loadCsvToTimetable('data/平日ダイヤ.csv').then(csvTimetable => {
  // 既存の timetable を csvTimetable に置き換えてから updateDepartureInfo を呼ぶ
});
```

注意: `fetch()` で `file://` から直接読み込むことはできないため、上記を利用する際は簡易サーバ（`python -m http.server` など）で配信してください。

**よくある要望と対応案**
- 「ページから CSV をアップロードして使いたい」: `<input type="file">` を追加し、FileReader で CSV を読み込めます。実装を希望すれば手を入れます。
- 「UI に『時刻表を適用する』ボタンを追加したい」: `index.html` にテキスト入力とボタンを追加し、ボタン押下で `script.js` の timetable を置き換える実装が可能です。
- 「24 時跨ぎの適切な扱い」: 現状 `script.js` に簡易的な日跨ぎ処理がありますが、より堅牢にするには時刻を Date オブジェクトに変換して比較する方法が望ましいです。

**トラブルシューティング**
- 表示が更新されない／CSV が読み込めない: サーバで配信しているか確認してください（ブラウザのコンソールにエラーが出ます）。
- 時刻比較がおかしい: `script.js` の時刻処理は文字列ベースの変換を使っています。必要なら ISO 時刻やタイムスタンプに置き換えます。

---

必要であれば、次のどれを行いましょうか？
- `index.html` にページ内の「使い方」セクションを追加する
- CSV 読み込み（`fetch`）の実装を `script.js` に追加する
- ファイルアップロード UI（`<input type="file">`）を追加する

希望を教えてください。